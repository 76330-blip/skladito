# 📋 ТЕХНИЧЕСКОЕ ЗАДАНИЕ
# **"SKLADITO" v2.0 (API-версия)**

**Дата:** 30 января 2026  
**Версия:** 2.0 (API)  
**Статус:** Production Ready

---

## 1️⃣ ОПИСАНИЕ ПРОЕКТА

**Название:** SKLADITO (API-версия)  
**Тип:** Веб-приложение для учета хранимого барахла с серверной синхронизацией  
**Платформа:** Универсальная (любое устройство с браузером)  
**Архитектура:** Client-Server (REST API)  
**Технологии:**
- **Backend:** Node.js + Express + MongoDB
- **Frontend:** HTML5, CSS3, JavaScript (Vanilla JS)
- **Deployment:** Docker containers на Synology NAS

**Назначение:** Учёт и организация предметов в контейнерах с неограниченной вложенностью и синхронизацией между устройствами

---

## 2️⃣ АРХИТЕКТУРА СИСТЕМЫ

### **Компоненты:**

```
┌─────────────────────────────────────────┐
│  Пользователь (браузер/мобильное)      │
└────────────────┬────────────────────────┘
                 │ HTTP
                 ↓
┌─────────────────────────────────────────┐
│  Nginx (порт 8080)                      │
│  - Раздача статики (HTML/CSS/JS)       │
│  - Proxy для /api/*                     │
└────────────────┬────────────────────────┘
                 │
                 ↓
┌─────────────────────────────────────────┐
│  Node.js API (порт 3000)                │
│  - REST endpoints                        │
│  - Бизнес-логика                        │
│  - Валидация данных                     │
└────────────────┬────────────────────────┘
                 │
                 ↓
┌─────────────────────────────────────────┐
│  MongoDB (порт 27017)                   │
│  - База данных warehouse                │
│  - Collections: containers, items,      │
│    categories                           │
└─────────────────────────────────────────┘
```

### **Docker контейнеры:**

1. **warehouse-db** (MongoDB 4.4)
2. **warehouse-api** (Node.js 18 + Express)
3. **warehouse-nginx** (Nginx Alpine)

### **Сетевое взаимодействие:**

- Пользователь → Nginx: `http://IP:8080`
- Nginx → API: `http://warehouse-api:3000` (Docker link)
- API → MongoDB: `mongodb://warehouse-db:27017/warehouse` (Docker link)

---

## 3️⃣ СТРУКТУРА ДАННЫХ

### **КОНТЕЙНЕР**
```javascript
{
  id: string,              // Уникальный ID (формат: c1234567890)
  name: string,            // Название контейнера (обязательно)
  photo: string | null,    // Base64 фото (опционально)
  parent: string | null,   // ID родительского контейнера (null = корневой)
  created: Date            // ISO 8601 дата создания
}
```

**Управление фото:**
- Можно добавить при создании
- Можно добавить/заменить при редактировании
- Можно удалить

### **ПРЕДМЕТ**
```javascript
{
  id: string,              // Уникальный ID (формат: i1234567890)
  name: string,            // Название предмета (обязательно)
  quantity: number,        // Количество (min: 1)
  category: string | null, // ID категории (опционально)
  photo: string | null,    // Base64 фото (опционально)
  container: string,       // ID контейнера (обязательно)
  created: Date            // ISO 8601 дата создания
}
```

**Управление фото:**
- Можно добавить при создании
- Можно добавить/заменить при редактировании
- Можно удалить

### **КАТЕГОРИЯ**
```javascript
{
  id: string,    // Уникальный ID (формат: cat1234567890)
  name: string,  // Название категории
  icon: string,  // Эмодзи иконка (1-2 символа)
  order: number  // Порядок сортировки
}
```

**Управление категориями:**
- Создание/удаление через интерфейс (модальное окно)
- Редактируемый справочник
- При удалении категории предметы остаются без категории

---

## 4️⃣ API ENDPOINTS

### **Health Check**
```
GET /health
Response: { status: "ok", version: "2.0" }
```

### **Синхронизация**
```
GET /sync
Response: {
  containers: [...],
  items: [...],
  categories: [...]
}
```

### **Контейнеры**
```
GET    /containers         - Получить все
POST   /containers         - Создать
PUT    /containers/:id     - Обновить
DELETE /containers/:id     - Удалить (только пустой)
```

### **Предметы**
```
GET    /items              - Получить все
POST   /items              - Создать
PUT    /items/:id          - Обновить
DELETE /items/:id          - Удалить
```

### **Категории**
```
GET /categories            - Получить все
```

### **Поиск**
```
GET /search?q=запрос
Response: { containers: [...], items: [...] }
```

---

## 5️⃣ ФУНКЦИОНАЛЬНЫЕ ТРЕБОВАНИЯ

### ✅ **КОНТЕЙНЕРЫ**

**Создание:**
- [x] Создать с названием (обязательно)
- [x] Добавить фото (опционально, до 5 МБ)
- [x] Создать внутри другого контейнера
- [x] Создать корневой контейнер

**Просмотр:**
- [x] Просмотр содержимого
- [x] Навигация по иерархии
- [x] Хлебные крошки
- [x] Количество объектов

**Редактирование:**
- [x] Изменить название
- [x] Добавить фото
- [x] Заменить фото
- [x] Удалить фото

**Удаление:**
- [x] Удалить пустой
- [x] Блокировка удаления непустого

---

### ✅ **ПРЕДМЕТЫ**

**Создание:**
- [x] Название + количество
- [x] Категория (опционально)
- [x] Фото (опционально)

**Просмотр:**
- [x] В контейнере
- [x] По категориям
- [x] С иконкой категории

**Редактирование:**
- [x] Название
- [x] Количество
- [x] Категория
- [x] Добавить фото
- [x] Заменить фото
- [x] Удалить фото

**Удаление:**
- [x] С подтверждением

---

### ✅ **КАТЕГОРИИ (Справочник)**

- [x] Просмотр списка
- [x] Создание (название + иконка)
- [x] Удаление
- [x] Счётчик предметов
- [x] Предупреждение при удалении с предметами

---

### ✅ **ИНТЕРФЕЙС**

**Главный экран:**
- [x] Название приложения с версией (SKLADITO LAN v2.0)
- [x] Список корневых контейнеров
- [x] Поисковая строка
- [x] FAB кнопка с меню
- [x] **БЕЗ категорий** (категории доступны только через FAB меню)

**FAB Menu (при нажатии +):**
- [x] 📦 Создать контейнер
- [x] 📌 Создать предмет
- [x] 🏷️ Управление категориями (доступ к просмотру категорий)

**НЕ показывать:**
- [x] Статистика убрана (не нужна)
- [x] Категории на главной (убраны - доступ через FAB меню)

---

## 6️⃣ ТЕХНИЧЕСКИЕ ДЕТАЛИ

### **Nginx конфигурация:**

```nginx
server {
    listen 80;
    client_max_body_size 10M;
    
    location / {
        root /usr/share/nginx/html;
        try_files $uri $uri/ /index.html;
    }
    
    location /api/ {
        proxy_pass http://warehouse-api:3000/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

### **Docker volumes:**

```
warehouse-db:
  /docker/warehouse/mongodb-data → /data/db

warehouse-api:
  /docker/warehouse/api → /app

warehouse-nginx:
  /docker/warehouse/frontend → /usr/share/nginx/html
  /docker/warehouse/nginx.conf → /etc/nginx/conf.d/default.conf
```

### **Файлы для развертывания:**

1. `server.js` - API сервер
2. `package.json` - зависимости Node.js
3. `nginx.conf` - конфигурация Nginx
4. `index.html` - фронтенд приложения

---

## 7️⃣ ОТЛИЧИЯ ОТ ЛОКАЛЬНОЙ ВЕРСИИ

| Параметр | Локальная | API |
|----------|-----------|-----|
| Хранение | LocalStorage | MongoDB |
| Синхронизация | Нет | Да |
| Доступ | Одно устройство | Все в сети |
| Установка | Открыть HTML | Docker |
| Размер данных | ~10MB | Неограничен |

---

## 8️⃣ ТРЕБОВАНИЯ К РАЗВЕРТЫВАНИЮ

- Synology NAS с Docker
- 512 MB RAM
- 1 GB дискового пространства
- Локальная сеть

---

**КОНЕЦ ДОКУМЕНТА**
